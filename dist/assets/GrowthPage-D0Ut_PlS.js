import{c as $,u as C,b as E,a as F,r as a,j as e,L as z,F as A,C as I,U as j,z as R}from"./index-B3PE86Dq.js";const T=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],S=$("dollar-sign",T),D="https://bull-rush-backend-production.up.railway.app";function U(){const{user:t}=C(),{getToken:u}=E(),s=F(),[h,m]=a.useState(""),[g,c]=a.useState(null),[d,p]=a.useState({one_time_total:0,ongoing_total:0,grand_total:0}),[f,x]=a.useState(!0),[r,o]=a.useState(!1),i=a.useRef(!0);return a.useEffect(()=>{i.current=!0;async function b(){if(!(!t||!s))try{x(!0);const{data:n}=await s.from("users").select("referrer_id, referral_code").eq("id",t.id).single();n&&(m(n.referral_code||t.id),n.referrer_id&&o(!0));const{data:_}=await s.rpc("get_downline_tree_v2",{root_user_id:t.id});c(_);const{data:y,error:L}=await s.from("referral_bonuses").select("amount, bonus_type").eq("referrer_id",t.id);if(console.log(L),y){const v=y.filter(l=>l.bonus_type==="first_investment").reduce((l,N)=>l+Number(N.amount),0),k=y.filter(l=>l.bonus_type==="ongoing").reduce((l,N)=>l+Number(N.amount),0);p({one_time_total:v,ongoing_total:k,grand_total:v+k})}}catch(n){console.error("Referral Sync Error:",n)}finally{i.current&&x(!1)}}return b(),()=>{i.current=!1}},[t,s]),{myReferralCode:h,downline:g,bonuses:d,loading:f,applyReferralCode:async b=>{const n=await u();return(await fetch(`${D}/api/referral/apply`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({referralCode:b})})).ok?(o(!0),!0):!1},hasReferrer:r}}const q=()=>{const{myReferralCode:t,downline:u,bonuses:s,loading:h,applyReferralCode:m,hasReferrer:g}=U(),{user:c,isLoaded:d}=C(),p=`${window.location.origin}/?ref=${t}`;a.useEffect(()=>{(async()=>{if(d&&c&&!g){const o=localStorage.getItem("pending_referral_code");o&&await m(o)&&localStorage.removeItem("pending_referral_code")}})()},[c,d,g,m]);const f=()=>{navigator.clipboard.writeText(p).then(()=>R.success("Referral link copied!")).catch(()=>R.error("Failed to copy link"))};if(!d||h)return e.jsx(z,{});const x=r=>{if(!r)return null;const o=r.id?r.id.slice(-5):"Unknown",i=r.display_name||`User...${o}`;return e.jsxs("li",{className:"ml-6",children:[e.jsxs("div",{className:"bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-100",children:[e.jsx("p",{className:"font-medium",children:i}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Level ",r.level," â€¢ Active: $",Number(r.active_invested||0).toFixed(2)]})]}),r.children&&r.children.length>0&&e.jsx("ul",{className:"mt-2 border-l-2 border-indigo-200 pl-4",children:r.children.map(w=>x(w))})]},r.id||Math.random())};return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsxs("div",{className:"max-w-4xl mx-auto p-8 space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Growth & Referrals"}),e.jsx("div",{className:"bg-linear-to-r from-indigo-600 to-purple-600 text-white p-8 rounded-3xl shadow-lg relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Invite & Earn Passive Income"}),e.jsxs("div",{className:"flex items-center gap-3 bg-white/10 p-2 rounded-2xl backdrop-blur-md border border-white/20",children:[e.jsx("code",{className:"flex-1 px-4 text-sm font-mono truncate",children:p}),e.jsx("button",{onClick:f,className:"p-3 bg-white text-indigo-600 rounded-xl hover:bg-indigo-50 transition-colors shadow-sm",children:e.jsx(I,{size:20})})]}),e.jsx("p",{className:"mt-4 text-sm text-indigo-100",children:"New users clicking your link will be automatically added to your network."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm text-center",children:[e.jsx(S,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-black text-gray-800",children:["$",s.one_time_total.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:"One-time Bonuses"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm text-center",children:[e.jsx(j,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-black text-gray-800",children:["$",s.ongoing_total.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:"Ongoing Passive"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(S,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("p",{className:"text-2xl font-black text-gray-800",children:["$",s.grand_total.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:"Total Earnings"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-3xl p-8 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-bold mb-8 flex items-center gap-3 text-gray-800",children:[e.jsx(j,{size:24,className:"text-indigo-600"}),"Your Referral Network"]}),u?.children?.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("ul",{className:"space-y-6",children:[e.jsxs("li",{className:"font-bold text-center bg-gray-50 py-4 rounded-2xl border border-dashed border-gray-200 mb-8",children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase mb-1",children:"Root Account"}),c?.firstName||"You"]}),u.children.map(r=>x(r))]})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(j,{size:32,className:"text-gray-300"})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No direct referrals yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Share your link to start earning commissions."})]})]})]})]})};export{q as default};
