import{u as k,a as D,r as o,j as e,L}from"./index-9vti2cmb.js";function M(){const{user:r}=k(),a=D(),[s,n]=o.useState([]),[g,d]=o.useState([]),[u,p]=o.useState([]),[t,c]=o.useState(!0),[y,i]=o.useState({total:0,monthly:0,halfYearly:0,yearly:0,currentMonthEarning:0});return o.useEffect(()=>{async function x(){if(!r?.id||!a)return;c(!0);const{data:l}=await a.from("user_earning_summaries").select("*").eq("user_id",r.id).single(),{data:f,error:v}=await a.from("user_monthly_performance").select("*").eq("user_id",r.id).order("month_year",{ascending:!1}).limit(100),{data:j}=await a.from("interest_payouts").select("id, amount_added, created_at, investments!inner(plan_type, initial_amount, user_id)").eq("investments.user_id",r.id).order("created_at",{ascending:!1}),{data:w}=await a.from("withdrawals").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(l&&i(h=>({...h,total:Number(l.total_lifetime_roi),monthly:Number(l.total_monthly_roi),halfYearly:Number(l.total_half_yearly_roi),yearly:Number(l.total_yearly_roi)})),console.log(v),f){p(f);const h=new Date,S=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-01`,N=f.find(b=>b.month_year===S);N&&i(b=>({...b,currentMonthEarning:Number(N.monthly_roi)}))}j&&n(j),w&&d(w),c(!1)}x()},[r?.id,a]),{rewards:s,withdrawals:g,monthlyStats:u,stats:y,loading:t}}const m=({title:r,value:a,color:s,subtitle:n})=>e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1",children:r}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:`text-2xl font-black ${s}`,children:a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("span",{className:"text-[10px] font-bold text-gray-400",children:"ShreeX"})]}),e.jsx("p",{className:"text-[9px] text-gray-300 mt-3 font-bold uppercase",children:n})]}),_=({title:r,data:a,type:s})=>{const[n,g]=o.useState(20),d=a.slice(0,n),u=n<a.length,p=()=>{g(t=>Math.min(t+20,a.length))};return e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100",children:[e.jsxs("div",{className:"px-8 py-5 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-black text-gray-800 tracking-tight",children:r}),e.jsxs("span",{className:"px-3 py-1 bg-gray-100 text-gray-400 text-[10px] rounded-full font-black uppercase",children:[a.length," record",a.length!==1?"s":""]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"sticky top-0 bg-white border-b border-gray-100 z-10",children:e.jsxs("tr",{className:"bg-gray-50/50 text-gray-400 text-[10px] uppercase font-bold tracking-widest",children:[e.jsx("th",{className:"px-8 py-4",children:"Date"}),e.jsx("th",{className:"px-8 py-4",children:s==="rewards"?"Plan":"Status"}),e.jsx("th",{className:"px-8 py-4",children:"Details"}),e.jsx("th",{className:"px-8 py-4",children:"Transaction"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-16 text-center text-gray-300 text-xs font-bold uppercase tracking-widest",children:"No activity recorded"})}):d.map(t=>{const c=s==="withdrawals"&&!!t.wallet_address,y=s==="withdrawals"&&!!t.phone_number,i=t.status?.toLowerCase()==="rejected",x=t.status?.toLowerCase()==="pending",l=["sent","approved","completed"].includes(t.status?.toLowerCase()||"");return e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-8 py-4 text-xs font-medium text-gray-500",children:new Date(t.created_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-8 py-4",children:s==="rewards"?e.jsx("span",{className:"px-3 py-1 rounded-md bg-indigo-50 text-indigo-700 text-[9px] font-black uppercase",children:t.investments?.plan_type||"N/A"}):e.jsx("span",{className:`px-3 py-1 rounded-md text-[9px] font-black uppercase ${C(t.status)}`,children:i?"Rejected":x?"Pending":l?"Completed":t.status||"Unknown"})}),e.jsx("td",{className:"px-8 py-4 text-xs text-gray-600",children:s==="rewards"?e.jsxs("span",{className:"italic",children:["Interest on ",Number(t.investments?.initial_amount||0).toLocaleString()," ShreeX investment"]}):c?e.jsxs("code",{className:"font-mono bg-gray-100 px-2 py-1 rounded text-[11px]",children:[t.wallet_address?.slice(0,8),"...",t.wallet_address?.slice(-6)]}):y?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-green-700 font-semibold text-xs",children:"Mobile Money"}),e.jsx("code",{className:"font-mono bg-emerald-100 px-2 py-1 rounded text-[11px] text-emerald-800",children:t.phone_number})]}):e.jsx("span",{className:"italic text-gray-400",children:"Internal transfer"})}),e.jsx("td",{className:"px-8 py-4",children:s==="rewards"?e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-600 text-[9px] font-bold rounded-md uppercase",children:"Accrued (Off-Chain)"}):l&&t.tx_hash?e.jsxs("a",{href:`https://tronscan.org/#/transaction/${t.tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:underline text-xs font-mono truncate block max-w-xs",children:[t.tx_hash.slice(0,10),"...",t.tx_hash.slice(-8)]}):x?e.jsx("span",{className:"text-orange-600 text-xs font-medium italic",children:"Pending processing"}):i?e.jsx("span",{className:"text-red-600 text-xs font-medium italic",children:"Rejected & refunded"}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"Manual / No tx"})}),e.jsxs("td",{className:`px-8 py-4 text-right font-black text-sm ${s==="rewards"?"text-green-600":i?"text-gray-500":"text-red-600"}`,children:[s==="rewards"?"+":i?"Â±":"-",Number(t.amount_added||t.amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ","ShreeX"]})]},t.id)})})]})}),u&&e.jsx("div",{className:"px-8 py-5 border-t border-gray-100 text-center",children:e.jsxs("button",{onClick:p,className:"px-6 py-3 bg-indigo-600 text-white text-sm font-bold rounded-full hover:bg-indigo-700 transition-shadow shadow-md active:scale-95",children:["Load More (",a.length-n," remaining)"]})})]})},C=r=>{const a=r?.toLowerCase();return a==="pending"?"bg-orange-50 text-orange-700":a==="rejected"?"bg-red-50 text-red-700":["sent","approved","completed"].includes(a||"")?"bg-green-50 text-green-700":"bg-gray-50 text-gray-600"},P=()=>{const{rewards:r,withdrawals:a,stats:s,loading:n}=M();return n?e.jsx(L,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("header",{className:"mb-10",children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 tracking-tight",children:"Financial Analytics"}),e.jsx("p",{className:"text-gray-500 mt-2 font-medium",children:"Detailed breakdown of your investment performance."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-10",children:[e.jsx(m,{title:"Lifetime ROI",value:s.total,color:"text-indigo-600",subtitle:"Total interest generated"}),e.jsx(m,{title:"Monthly Plans",value:s.monthly,color:"text-green-600",subtitle:"Earnings from monthly plan"}),e.jsx(m,{title:"Half Yearly Plans",value:s.halfYearly,color:"text-blue-600",subtitle:"Earnings from half-yearly plan"}),e.jsx(m,{title:"Yearly Plans",value:s.yearly,color:"text-blue-600",subtitle:"Earnings from yearly plan"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(_,{title:"Reward Logs",data:r,type:"rewards"}),e.jsx(_,{title:"Withdrawal Logs",data:a,type:"withdrawals"})]})]})})};export{P as default};
