import{c as I,u as E,b as A,a as T,r as o,j as e,L as $,d as D,F,C as P,D as S,U as C,z as L}from"./index-B2AKnPFA.js";const U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],q=I("arrow-right",U),B="https://bull-rush-backend-production.up.railway.app";function M(){const{user:r}=E(),{getToken:f}=A(),s=T(),[c,p]=o.useState(""),[g,h]=o.useState(null),[b,d]=o.useState({one_time_total:0,ongoing_total:0,grand_total:0}),[x,u]=o.useState(!0),[y,m]=o.useState(!1),[t,n]=o.useState(!1),l=o.useRef(!0);return o.useEffect(()=>{l.current=!0;async function j(){if(!(!r||!s))try{u(!0);const{data:a}=await s.from("users").select("referrer_id, referral_code").eq("id",r.id).single();a&&(p(a.referral_code||r.id),a.referrer_id&&m(!0));const{count:_}=await s.from("investments").select("*",{count:"exact",head:!0}).eq("user_id",r.id);n((_??0)>0);const{data:z}=await s.rpc("get_downline_tree_v2",{root_user_id:r.id});h(z);const{data:w}=await s.from("referral_bonuses").select("amount, bonus_type").eq("referrer_id",r.id);if(w){const k=w.filter(i=>i.bonus_type==="first_investment").reduce((i,N)=>i+Number(N.amount),0),R=w.filter(i=>i.bonus_type==="ongoing").reduce((i,N)=>i+Number(N.amount),0);d({one_time_total:k,ongoing_total:R,grand_total:k+R})}}catch(a){console.error("Referral Sync Error:",a)}finally{l.current&&u(!1)}}return j(),()=>{l.current=!1}},[r,s]),{myReferralCode:c,downline:g,bonuses:b,loading:x,applyReferralCode:async j=>{try{const a=await f();if((await fetch(`${B}/api/referral/apply`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({referralCode:j})})).ok)return m(!0),!0}catch(a){console.error("Failed to apply code",a)}return!1},hasReferrer:y,isEligible:t}}const G=({onNavigateToInvest:r})=>{const{myReferralCode:f,downline:s,bonuses:c,loading:p,applyReferralCode:g,hasReferrer:h,isEligible:b}=M(),{user:d,isLoaded:x}=E(),u=`${window.location.origin}/?ref=${f}`;o.useEffect(()=>{(async()=>{if(x&&d&&!h){const n=localStorage.getItem("pending_referral_code");n&&await g(n)&&localStorage.removeItem("pending_referral_code")}})()},[d,x,h,g]);const y=()=>{navigator.clipboard.writeText(u).then(()=>L.success("Referral link copied!")).catch(()=>L.error("Failed to copy link"))};if(!x||p)return e.jsx($,{});if(!b)return e.jsx("div",{className:"max-w-4xl mx-auto p-6 md:p-8",children:e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-200 rounded-[2.5rem] p-8 md:p-16 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-50 rounded-3xl flex items-center justify-center mx-auto mb-6",children:e.jsx(D,{className:"text-indigo-600",size:32})}),e.jsx("h1",{className:"text-3xl font-black text-gray-900 mb-4",children:"Referral Program Locked"}),e.jsxs("p",{className:"text-gray-500 max-w-md mx-auto mb-8 leading-relaxed",children:["To maintain a high-quality network, you must have at least one",e.jsx("span",{className:"font-bold text-gray-800",children:" active investment plan "}),"to generate your referral link and earn commissions."]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200",children:["Get Started ",e.jsx(q,{size:20})]})]})});const m=t=>{if(!t)return null;const n=t.id?t.id.slice(-5):"Unknown",l=t.display_name||`User...${n}`;return e.jsxs("li",{className:"ml-6",children:[e.jsxs("div",{className:"bg-indigo-50/50 px-4 py-3 rounded-2xl border border-indigo-100 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-indigo-900",children:l}),e.jsxs("p",{className:"text-xs text-indigo-600 font-medium",children:["Level ",t.level]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:["$",Number(t.active_invested||0).toLocaleString()]}),e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold tracking-tighter",children:"Active Invested"})]})]}),t.children&&t.children.length>0&&e.jsx("ul",{className:"mt-3 border-l-2 border-indigo-100 pl-4 space-y-3",children:t.children.map(v=>m(v))})]},t.id||Math.random())};return e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6 md:p-8 space-y-8",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 tracking-tight",children:"Growth & Referrals"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Build your network and earn passive bonuses."})]}),e.jsxs("div",{className:"bg-linear-to-br from-indigo-600 to-purple-700 text-white p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Invite & Earn Passive Income"}),e.jsxs("div",{className:"flex items-center gap-3 bg-white/10 p-2 rounded-2xl backdrop-blur-xl border border-white/20",children:[e.jsx("code",{className:"flex-1 px-4 text-sm font-mono truncate opacity-90",children:u}),e.jsx("button",{onClick:y,className:"p-3 bg-white text-indigo-600 rounded-xl hover:scale-105 transition-transform shadow-lg",children:e.jsx(P,{size:20})})]})]}),e.jsx("div",{className:"absolute top-[-10%] right-[-5%] w-64 h-64 bg-white/10 rounded-full blur-3xl"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[{label:"One-time Bonuses",val:c.one_time_total,color:"text-green-600",icon:e.jsx(S,{})},{label:"Ongoing Passive",val:c.ongoing_total,color:"text-blue-600",icon:e.jsx(C,{})},{label:"Total Earnings",val:c.grand_total,color:"text-purple-600",icon:e.jsx(S,{})}].map((t,n)=>e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-gray-100 shadow-sm text-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mx-auto mb-3 bg-gray-50 ${t.color}`,children:t.icon}),e.jsxs("p",{className:"text-2xl font-black text-gray-900",children:["$",t.val.toFixed(2)]}),e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest mt-1",children:t.label})]},n))}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-[2.5rem] p-8 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-bold mb-8 flex items-center gap-3 text-gray-900",children:[e.jsx(C,{size:24,className:"text-indigo-600"}),"Your Referral Network"]}),s?.children?.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("ul",{className:"space-y-6",children:[e.jsx("li",{className:"font-bold text-center bg-gray-50/50 py-4 rounded-2xl border-2 border-dashed border-gray-100 mb-8 text-gray-400 text-sm",children:d?.firstName||"Your Root Account"}),s.children.map(t=>m(t))]})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400 font-medium",children:"No referrals found yet."})})]})]})]})};export{G as default};
